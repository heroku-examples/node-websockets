"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getVarDictionnary = void 0;
/**
 * Decode Dictionnary
 * @param genericDecoder
 * @param buf {Buffer}
 * @returns {{value: Object, length: Number}}
 */
function getVarDictionnary(genericDecoder, buf) {
    var nbEntries = buf.readUInt32LE(0) & 0x7FFFFFFF;
    // const shared = !!buf.readUInt32LE(0) & 0x80000000
    var data = {
        dictionary: {},
        pos: 0,
        buffer: buf.slice(4)
    };
    for (var index = 0; index < nbEntries; index++) {
        var decodedKey = genericDecoder(data.buffer);
        data.pos += decodedKey.length + 4; // 4 type length
        var nextBuffer = data.buffer.slice(decodedKey.length + 4);
        var decodedValue = genericDecoder(nextBuffer);
        var nextBufferOffset = (decodedValue.length + ((4 - decodedValue.length % 4) % 4)) + 4; // Pad to 4 bytes + 4 bytes type
        data.pos += nextBufferOffset;
        data.dictionary[decodedKey.value] = decodedValue.value;
        data.buffer = nextBuffer.slice(nextBufferOffset);
    }
    return {
        value: data.dictionary,
        length: data.pos + 4 // 4 type length
    };
}
exports.getVarDictionnary = getVarDictionnary;
